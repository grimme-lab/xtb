name: CI
on: [push, pull_request]
env:
   BUILD_DIR: _build
jobs:
   gcc-cmake-build:
      runs-on: ${{ matrix.os }}
      strategy:
         fail-fast: false
         matrix:
            os: [ubuntu-latest]
            fc: [gfortran-14]
            cc: [gcc-14]
            build: [Debug]
      steps:
         - name: Checkout code
           uses: actions/checkout@v4
         - name: Setup Python
           uses: actions/setup-python@v5
           with:
            python-version: 3.x
         - name: Install OpenBLAS (ubuntu-latest)
           if: ${{ matrix.os == 'ubuntu-latest' || contains(matrix.os, 'ubuntu-24.04') }}
           run: |
            sudo apt-get install libopenblas-dev
         - name: Install CMake
           run: pip install ninja cmake
         - name: Configure build
           run: cmake -B ${{ env.BUILD_DIR }} -G Ninja -DCMAKE_BUILD_TYPE=${{ matrix.build }}
           env:
            FC: ${{ matrix.fc }}
            CC: ${{ matrix.cc }}
         - name: Build project
           run: cmake --build ${{ env.BUILD_DIR }}
         - name: Run unit tests
           run: ctest --parallel --output-on-failure -R 'xtb/gfn0' --repeat-until-fail 100
           working-directory: ${{ env.BUILD_DIR }}
           env:
            OMP_NUM_THREADS: 2,1
